<%page expression_filter="h"/>
<%namespace name='static' file='../static_content.html'/>
<%!
from django.utils.translation import ugettext as _
from django.utils.translation import pgettext
from django.urls import reverse
from lms.djangoapps.courseware.courses import get_course_about_section
from lms.djangoapps.courseware.toggles import is_courses_default_invite_only_enabled
from django.conf import settings
from six import text_type
from common.djangoapps.edxmako.shortcuts import marketing_link
from openedx.core.djangolib.js_utils import js_escaped_string
from openedx.core.djangolib.markup import clean_dangerous_html, HTML, Text
from openedx.core.lib.courses import course_image_url

from six import string_types
%>

<%inherit file="../main.html" />
<%block name="headextra">
  ## OG (Open Graph) title and description added below to give social media info to display
  ## (https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content#tags)
  <meta property="og:title" content="${course.display_name_with_default}" />
  <meta property="og:description" content="${get_course_about_section(request, course, 'short_description')}" />
</%block>

<%block name="js_extra">
  <script type="text/javascript">
  (function() {
    $(".register").click(function(event) {
      $("#class_enroll_form").submit();
      event.preventDefault();
    });

    $('#class_enroll_form').on('ajax:complete', function(event, xhr) {
      if (xhr.status == 200) {
        if (xhr.responseText == "") {
          location.href = "${reverse('dashboard') | n, js_escaped_string}";
        }
        else {
          location.href = xhr.responseText;
        }
      } else if (xhr.status == 403) {
        // redirect unauthenticated user to the login page
        location.replace("${reverse('signin_user') | n, js_escaped_string}?next=" + encodeURIComponent("${request.path | n, js_escaped_string}"));
      } else {
        $('#register_error').text(
            (xhr.responseText ? xhr.responseText : "${_("An error occurred. Please try again later.") | n, js_escaped_string}")
        ).css("display", "block");
      }
    });

  })(this)
  </script>

  <script src="${static.url('js/course_info.js')}"></script>
</%block>

<%block name="pagetitle">${course.display_name_with_default}</%block>

<style>
    .jumbotron-brand {
        background-color: #553C8B;
        opacity: 0.9;
        height: 360px;
    }
    .brand-title {
        font-family: 'Montserrat', sans-serif;
        line-height: 140%;
    }
</style>

<main id="main" aria-label="Content" tabindex="-1" class="">
    <div class="home">
        <%block name="course_about_header">
        <div class="jumbotron-brand d-flex justify-content-start align-items-center">
            <div class="ml-5">
                <h1 class="text-white font-weight-bold text-left brand-title">${course.display_name_with_default}</h1>
                <%block name="course_about_important_dates">
                <div class="d-flex flex-row justify-content-start">
                    <div class="d-flex flex-row align-items-center mr-2">
                        <span class="text-white icon fa fa-info-circle pr-2" aria-hidden="true"></span>
                        <p class="text-white pr-2">${_("Course Number")}</p>
                        <span class="text-white pr-2">${course.display_number_with_default}</span>
                    </div>
                    % if not course.start_date_is_still_default:
                        <%
                            course_start_date = course.advertised_start or course.start
                        %>
                        <div class="d-flex flex-row mr-2 align-items-center">
                            <span class="text-white icon fa fa-calendar pr-1" aria-hidden="true"></span>
                            <p class="text-white pr-1">${_("Classes Start")}</p>
                            % if isinstance(course_start_date, string_types):
                                <span class="text-white start-date pr-1">${course_start_date}</span>
                            % else:
                                <%
                                course_date_string = course_start_date.strftime('%Y-%m-%dT%H:%M:%S%z')
                                %>
                                <span class="text-white start-date localized_datetime pr-1" data-format="shortDate" data-datetime="${course_date_string}" data-language="${LANGUAGE_CODE}"></span>
                            % endif
                        </div>
                    % endif
                    ## We plan to ditch end_date (which is not stored in course metadata),
                    ## but for backwards compatibility, show about/end_date blob if it exists.
                    % if course.end:
                        <%
                            course_end_date = course.end
                        %>
                        <div class="d-flex flex-row mr-2 align-items-center">
                            <span class="text-white icon fa fa-calendar" aria-hidden="true"></span>
                            <p class="text-white pr-1">${_("Classes End")}</p>
                            % if isinstance(course_end_date, string_types):
                                <span class="text-white pr-1 final-date">${course_end_date}</span>
                            % else:
                                <%
                                    course_date_string = course_end_date.strftime('%Y-%m-%dT%H:%M:%S%z')
                                %>
                                <span class="text-white pr-1 final-date localized_datetime" data-format="shortDate" data-datetime="${course_date_string}" data-language="${LANGUAGE_CODE}"></span>
                            % endif
                        </div>
                    % endif
                    % if get_course_about_section(request, course, "effort"):
                        <div class="d-flex flex-row mr-2 align-items-center">
                            <span class="text-white icon fa fa-pencil pr-1" aria-hidden="true"></span>
                            <p class="text-white pr-1">${_("Estimated Effort")}</p>
                            <span class="text-white pr-1 effort">${get_course_about_section(request, course, "effort")}</span>
                        </div>
                    % endif
                        <div class="d-flex flex-row mr-2 align-items-center">
                            <span class="text-white icon fa fa-clock-o" aria-hidden="true"></span>
                            <p class="text-white pr-1">${_('Course Length')}</p>
                            <span class="text-white pr-1 course-length">${_('{number} weeks').format(number=15)}</span>
                        </div>
                    %if course_price and (is_cosmetic_price_enabled):
                        <div class="d-flex flex-row mr-2 align-items-center">
                            <span class="text-white pr-1 icon fa fa-money" aria-hidden="true"></span>
                            <p class="text-white pr-1">${_("Price")}</p>
                            <span class="text-white pr-1">${course_price}</span>
                        </div>
                    %endif
                    % if pre_requisite_courses:
                        <% prc_target = reverse('about_course', args=[text_type(pre_requisite_courses[0]['key'])]) %>
                        <div class="d-flex flex-row align-items-center mr-2">
                            <span class="text-white pr-1 icon fa fa-list-ul" aria-hidden="true"></span>
                            <p class="text-white pr-1">${_("Prerequisites")}</p>
                            ## Multiple pre-requisite courses are not supported on frontend that's why we are pulling first element
                            <span class="text-white pr-1 pre-requisite">
                                <a href="${prc_target}">${pre_requisite_courses[0]['display']}</a>
                            </span>
                            <p class="text-white tip pr-1">
                                ${Text(_("You must successfully complete {link_start}{prc_display}{link_end} before you begin this course.")).format(
                                link_start=HTML('<a href="{}">').format(prc_target),
                                link_end=HTML('</a>'),
                                prc_display=pre_requisite_courses[0]['display'],
                                )}
                            </p>
                        </div>
                    % endif
                    % if get_course_about_section(request, course, "prerequisites"):
                        <div class="d-flex flex-row mr-2 align-items-center">
                            <span class="text-white pr-1 icon fa fa-book" aria-hidden="true"></span>
                            <p class="text-white pr-1">${_("Requirements")}</p>
                            <span class="text-white pr-1 prerequisites">${get_course_about_section(request, course, "prerequisites")}</span>
                        </div>
                    % endif
                </div>
                </%block>
                <div class="main-cta mt-5">
                %if user.is_authenticated and registered:
                    %if show_courseware_link:
                        <a type="button" class="btn btn-brand-white" href="${course_target}">
                    %endif
                            <span class="register disabled">${_("You are enrolled in this course")}</span>
                            %if show_courseware_link:
                            <strong>${_("View Course")}</strong>
                        </a>
                            %endif
                % elif is_course_full:
                    <span class="register disabled">${_("Course is full")}</span>
                % elif (is_courses_default_invite_only_enabled() or invitation_only) and not can_enroll:
                    <span class="register disabled">${_("Enrollment in this course is by invitation only")}</span>
                    ## Shib courses need the enrollment button to be displayed even when can_enroll is False,
                    ## because AnonymousUsers cause can_enroll for shib courses to be False, but we need them to be able to click
                    ## so that they can register and become a real user that can enroll.
                % elif not is_shib_course and not can_enroll:
                    <span class="register disabled">${_("Enrollment is Closed")}</span>
                %elif allow_anonymous:
                    %if show_courseware_link:
                        <a type="button" class="btn btn-brand-white" href="${course_target}"><strong>${_("View Course")}</strong></a>
                    %endif
                %elif is_document_required:
                    <a type="button" class="btn btn-brand-white" href="https://account.copp.knotta.ru" class="register">${_("Submit documents")}</a>
                    <div>
                        Для записи на курс требуется добавить в личный кабинет следующие документы:
                    </div>
                    <ul>
                        % for doc in required_doc_types:
                            <li>${doc['label']}</li>
                        % endfor
                    </ul>

                    <div>
                        Подтвержденные документы студента, которые потребуются для записи на курс:
                    </div>
                    <ul>
                        % for doc in exist_doc_types:
                            <li>${doc['label']}</li>
                        % endfor
                    </ul>
                %else:
                    <%
                        if ecommerce_checkout:
                            reg_href = ecommerce_checkout_link
                        else:
                            reg_href="#"
                        if single_paid_mode:
                            href_class = "add-to-cart"
                        else:
                            href_class = "register"
                    %>
                    <a type="button" class="btn btn-brand-white" href="${reg_href}" class="${href_class}">${_("Enroll Now")}</a>
                    <div id="register_error"></div>
                %endif
            </div>
            </div>
            <div class="mr-5">
                <%
                    if course_image_urls['large'] is None:
                        course_image_url = "static/images/brand/img-logo_full.svg"
                        background = 'background: #553C8B'
                    else:
                        course_image_url = course_image_urls['large']
                        background = 'background: '
                %>

                %if get_course_about_section(request, course, "video"):
                    <a href="#video-modal" class="media" rel="leanModal">
                        <img class="rounded-4 float-right" height="80%" src="${course_image_url}" alt="" />
                        <div class="play-intro"></div>
                    </a>
                %else:
                    <img class="rounded-4 float-right" height="100%" src="${course_image_url}" alt="" />
                % endif
            </div>
        </div>
        </%block>
    </div>


    <div class="container">
        <section class="about">
            ${course_details.__dict__}
            <h2>About This Course</h2>
            <p>Include your long course description here. The long course description should contain 150-400 words. Я быд здесь</p>
            <p>This is paragraph 2 of the long course description. Add more paragraphs as needed. Make sure to enclose them in paragraph tags.</p>
        </section>

        <section class="prerequisites">
            <h2>Requirements</h2>
            <p>Add information about the skills and knowledge students need to take this course.</p>
        </section>

        <section class="course-staff">
            <h2>Course Staff</h2>
            <article class="teacher">
                <div class="teacher-image">
                    <img src="/static/images/placeholder-faculty.png" align="left" style="margin:0 20 px 0" alt="Course Staff Image #1">
                </div>
                <h3>Staff Member #1</h3>
                <p>Biography of instructor/staff member #1</p>
            </article>
            <article class="teacher">
                <div class="teacher-image">
                    <img src="/static/images/placeholder-faculty.png" align="left" style="margin:0 20 px 0" alt="Course Staff Image #2">
                </div>
                <h3>Staff Member #2</h3>
                <p>Biography of instructor/staff member #2</p>
            </article>
        </section>

        <section class="faq">
            <section class="responses">
                <h2>Frequently Asked Questions</h2>
                <article class="response">
                    <h3>What web browser should I use?</h3>
                    <p>The Open edX platform works best with current versions of Chrome, Edge, Firefox, Internet Explorer, or Safari.</p>
                    <p>See our <a href="https://edx.readthedocs.org/projects/open-edx-learner-guide/en/latest/front_matter/browsers.html">list of supported browsers</a> for the most up-to-date information.</p>
                </article>

                <article class="response">
                    <h3>Question #2</h3>
                    <p>Your answer would be displayed here.</p>
                </article>
            </section>
        </section>

<!--    <%block name="course_about_details">-->
<!--    <div class="details">-->
<!--      % if staff_access and studio_url is not None:-->
<!--        <div class="wrap-instructor-info studio-view">-->
<!--          <a class="instructor-info-action" href="${studio_url}">${_("View About Page in studio")}</a>-->
<!--        </div>-->
<!--      % endif-->

<!--      <div class="inner-wrapper">-->
<!--        ${clean_dangerous_html(get_course_about_section(request, course, "overview"))}-->
<!--      </div>-->
<!--    </div>-->
<!--    </%block>-->

    <!-- TODO: Нужно переименовать переменные, чтобы не дублировать выше -->

      ## For now, ocw links are the only thing that goes in additional resources
      % if get_course_about_section(request, course, "ocw_links"):
      <div class="additional-resources">
        <header>
          <h1>${_("Additional Resources")}</h1>
      </div>

        <div>
          ## "MITOpenCourseware" should *not* be translated
          <h2 class="opencourseware">MITOpenCourseware</h2>
             ${get_course_about_section(request, course, "ocw_links")}
        </div>
    </div>
      %endif

    % if sidebar_html_enabled:
      % if get_course_about_section(request, course, "about_sidebar_html"):
        <section class="about-sidebar-html">
          ${get_course_about_section(request, course, "about_sidebar_html")}
        </section>
      % endif
    %endif
  </div>

  </div>
</div>

## Need to put this hidden form on the page so that the registration button works.
## Since it's no harm to display a hidden form, we display it with the most permissive conditional
## which is when the student is not registered.
%if active_reg_button or is_shib_course:
  <div style="display: none;">
    <form id="class_enroll_form" method="post" data-remote="true" action="${reverse('change_enrollment')}">
      <fieldset class="enroll_fieldset">
        <legend class="sr">${pgettext("self","Enroll")}</legend>
        <input name="course_id" type="hidden" value="${course.id}">
        <input name="enrollment_action" type="hidden" value="enroll">
      </fieldset>
      <div class="submit">
        <input name="submit" type="submit" value="${pgettext('self','enroll')}">
      </div>
    </form>
  </div>
%endif

<%include file="../video_modal.html" />

<%static:require_module_async module_name="js/dateutil_factory" class_name="DateUtilFactory">
    DateUtilFactory.transform(iterationKey=".localized_datetime");
</%static:require_module_async>
